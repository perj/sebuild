# Various special rules and definition files

## build_version.h

The version of the build is always written with a `#define BUILD_VERSION` into
the `build_version.h` file. The build version is generated by the script in
`buildversion_script` CONFIG option. If you include this file in your
source you'll have to add an explicit dependency on it.

Another way to get the build version is through .in files. There is an
automatic dependency there and you don't need to do anything.

## in.conf

The variables for .in files are generated into `build/obj/<flavor>/tools/in.conf`
with a script. The generated file must be of the form `KEY=value` and nothing
else, no comments, no extra whitespace, no nothing. This allows us to include
it from both Makefiles and ninja files.

For more information about infiles see the
[CONFIG parameter](descriptors/config.md#invars).

## static.ninja

The file `rules/static.ninja` contains certain static targets we need to build
and don't really have other ways to express them. Currently it contains the
rules for `build_version.h` and `in.conf`.

## rules.ninja

`rules/rules.ninja` contain the main rules for compilation (like how to invoke
compilers, how to link, etc.). Read the ninja documentation before changing
anything in `rules.ninja`. Be careful about failing rules which just simply
redirect some script output into the $out file. Make sure to remove the $out
file if the script fails. If you don't, the next build can get confused and not
rebuild the file even though it failed the previous time. Make removes the file
for you, ninja doesn't. There are some examples in there how to do this, but
the safest is probably to wrap everything in a script.
